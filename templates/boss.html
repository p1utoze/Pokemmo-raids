{% extends "base.html" %}

{% block sidebar %}
<div class="boss-list-compact">
    <a href="/">‚Üê Back</a>
    <h3>{{ boss.Name }} {{ boss.Stars }}‚òÖ</h3>
</div>
{% endblock %}

{% block content %}
<div class="auth-top-bar">
    {% if user_role %}
    <div class="auth-chip">Logged in as <strong>{{ user_role }}</strong></div>
    <a class="auth-btn" href="/admin">Admin Panel</a>
    <a class="auth-btn ghost" href="/auth/logout">Logout</a>
    {% else %}
    <div class="auth-chip muted">Staff Login</div>
    <a class="auth-btn" href="/auth/login">Login</a>
    {% endif %}
</div>

<div class="boss-page">
    <h2>{{ boss.Name }} {{ boss.Stars }}‚òÖ</h2>
    <p class="boss-desc">{{ boss.Description }} <button class="view-more" id="viewMoreBtn">View more</button></p>
    <!-- All variations are shown below; dropdown removed per user request -->

    <div class="tables-area">
        {% for var in boss.Variations %}
        <div class="variation-header">
            <h3 class="variation-title">Variation {{ var.Index }}</h3>
            {% if user_role %}
            <div style="display:flex;gap:8px;align-items:center">
                <button class="edit-variation-btn" data-variation-index="{{ var.Index0 }}">‚úèÔ∏è Edit</button>
                <button class="save-variation-btn" data-variation-index="{{ var.Index0 }}" style="display:none;">üíæ
                    Save</button>
                <button class="cancel-variation-btn" data-variation-index="{{ var.Index0 }}" style="display:none;">‚úñ
                    Cancel</button>
            </div>
            {% endif %}
        </div>
        <div class="variation-table" data-variation-index="{{ var.Index0 }}">
            <table class="plan-table">
                <thead>
                    <tr>
                        <th>Turn</th>
                        <th>Player 1</th>
                        <th>Player 2</th>
                        <th>Player 3</th>
                        <th>Player 4</th>
                        <th>Boss health</th>
                        <th>Side notes</th>
                    </tr>
                </thead>
                <tbody>
                    {{ var.TableHTML|safe }}
                </tbody>
            </table>
        </div>
        {% endfor %}
    </div>
</div>

<script type="application/json" id="boss-data">{{ bossJSON|safe }}</script>
<script src="https://cdn.jsdelivr.net/npm/fuse.js@6.6.2"></script>
<script src="/static/js/boss-edit.js"></script>
<aside class="right-sidebar" id="rightSidebar" aria-hidden="true">
    <button class="close-sidebar" id="closeSidebar">‚úï</button>
    <div class="sidebar-inner">
        <h3>General Info</h3>
        <ul class="info-list">
            <li><strong>Ability:</strong> {{ boss.Ability}}</li>
            <li><strong>Held Item:</strong> {{ boss.HeldItem }}</li>
            <li><strong>Stars:</strong> {{ boss.Stars}}</li>
            <li><strong>Speed EVs:</strong> {{ boss.SpeedEVs}}</li>
        </ul>

        <h3>Base Stats</h3>
        <ul class="base-stats">
            <li><strong>Speed:</strong> {{ boss.BaseStats.Speed }}</li>
            <li><strong>Defense:</strong> {{ boss.BaseStats.Def }}</li>
            <li><strong>Sp. Def:</strong> {{ boss.BaseStats.SpDef }}</li>
        </ul>

        {% if boss.Moves %}
        <h3>Moves</h3>
        <ul class="moves-list">
            {% for mv in boss.Moves %}
            <li>Move {{ loop.index }}: {{ mv.Name }} ({{ mv.Type }})</li>
            {% endfor %}
        </ul>
        {% endif %}

        {% if boss.PhaseEffects %}
        <h3>Phase Effects</h3>
        <ul class="phase-list">
            {% for pe in boss.PhaseEffects %}
            <li><strong>{{ pe.Health }}:</strong> {{ pe.Effect }}</li>
            {% endfor %}
        </ul>
        {% endif %}

    </div>
</aside>
{% endblock %}